# Fortranæ¨¡å—ä¾èµ–ç®¡ç† - å®Œå…¨è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆ ðŸš€

## âœ¨ å·²å®žçŽ°åŠŸèƒ½

ä½ çš„é¡¹ç›®çŽ°åœ¨æ‹¥æœ‰**å®Œå…¨è‡ªåŠ¨åŒ–çš„Fortranæ¨¡å—ä¾èµ–ç®¡ç†**ç³»ç»Ÿï¼

---

## ðŸŽ¯ æ ¸å¿ƒå‘½ä»¤ï¼ˆåªéœ€è®°ä½è¿™ä¸€ä¸ªï¼ï¼‰

```bash
make update-fortran-deps
```

**ä»€ä¹ˆæ—¶å€™è¿è¡Œï¼Ÿ**
- âœ… æ·»åŠ æ–°çš„Fortranæ–‡ä»¶
- âœ… ä¿®æ”¹æ¨¡å—ä¾èµ–ï¼ˆæ·»åŠ /åˆ é™¤ `use` è¯­å¥ï¼‰  
- âœ… é‡å‘½åFortranæ–‡ä»¶
- âœ… é¦–æ¬¡è®¾ç½®é¡¹ç›®

**å®ƒä¼šåšä»€ä¹ˆï¼Ÿ**
1. è‡ªåŠ¨æ‰«ææ‰€æœ‰ `.f90` å’Œ `.f` æ–‡ä»¶
2. åˆ†æžæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»
3. è®¡ç®—æ­£ç¡®çš„ç¼–è¯‘é¡ºåº
4. **è‡ªåŠ¨ç”Ÿæˆ** `contrib/tran_heat/tran_heat_auto.mk`
5. ä¸‹æ¬¡ç¼–è¯‘è‡ªåŠ¨ä½¿ç”¨æ­£ç¡®çš„é¡ºåº

---

## ðŸ“– å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ¬¡ä½¿ç”¨

```bash
cd /home/lvkas/projects/mooseprojects

# 1. ç”Ÿæˆä¾èµ–é…ç½®
make update-fortran-deps

# 2. æ­£å¸¸ç¼–è¯‘
make -j8

# å®Œæˆï¼âœ…
```

### æ—¥å¸¸ä½¿ç”¨

```bash
# ä¿®æ”¹äº†Fortranæºç åŽ
make update-fortran-deps

# ç„¶åŽç¼–è¯‘
make -j8
```

---

## ðŸ› ï¸ æ‰€æœ‰å¯ç”¨å‘½ä»¤

| å‘½ä»¤ | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| `make update-fortran-deps` | æ›´æ–°ä¾èµ–é…ç½® | ä¿®æ”¹Fortranä»£ç åŽ |
| `make check-fortran-deps` | æŸ¥çœ‹ä¾èµ–å…³ç³»ï¼ˆä¸ç”Ÿæˆæ–‡ä»¶ï¼‰ | è°ƒè¯•ä¾èµ–é—®é¢˜ |
| `make debug-tran_heat` | æ˜¾ç¤ºå½“å‰é…ç½® | æ£€æŸ¥ç¼–è¯‘çŠ¶æ€ |
| `make clean-tran_heat` | æ¸…ç†æž„å»ºäº§ç‰© | æ¸…ç†é‡å»º |
| `make -j8` | æ­£å¸¸ç¼–è¯‘ | æ—¥å¸¸ç¼–è¯‘ |

---

## ðŸ“‚ æ–‡ä»¶ç»“æž„

```
contrib/
â”œâ”€â”€ tran_heat/
â”‚   â”œâ”€â”€ src/                          # Fortranæºæ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ *.f90                     # ä½ çš„Fortran90ä»£ç 
â”‚   â”‚   â””â”€â”€ *.f                       # ä½ çš„Fortran77ä»£ç 
â”‚   â”œâ”€â”€ build/                        # ç¼–è¯‘äº§ç‰©ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ modules/                      # .modæ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â””â”€â”€ tran_heat_auto.mk            # ðŸ“Œ è‡ªåŠ¨ç”Ÿæˆçš„ä¾èµ–é…ç½®
â”œâ”€â”€ tran_heat.mk                      # Makeé…ç½®
â”œâ”€â”€ analyze_fortran_deps.py           # ðŸ¤– Pythonåˆ†æžå·¥å…·
â”œâ”€â”€ README_FORTRAN.md                 # æœ¬æ–‡ä»¶
â”œâ”€â”€ AUTO_WORKFLOW.md                  # è¯¦ç»†å·¥ä½œæµç¨‹
â”œâ”€â”€ FORTRAN_DEPENDENCY_GUIDE.md       # å®Œæ•´æŠ€æœ¯æŒ‡å—
â””â”€â”€ QUICK_START.md                    # 5åˆ†é’Ÿå¿«é€Ÿå…¥é—¨
```

---

## ðŸ” å·¥ä½œåŽŸç†

### è‡ªåŠ¨åŒ–æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿è¡Œ: make update-fortran-deps     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pythonè„šæœ¬åˆ†æžæ‰€æœ‰.f90æ–‡ä»¶        â”‚
â”‚  - è¯†åˆ« module å®šä¹‰                 â”‚
â”‚  - è¯†åˆ« use ä¾èµ–                    â”‚
â”‚  - æž„å»ºä¾èµ–å›¾                       â”‚
â”‚  - æ‹“æ‰‘æŽ’åºè®¡ç®—ç¼–è¯‘é¡ºåº             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è‡ªåŠ¨ç”Ÿæˆ tran_heat_auto.mk        â”‚
â”‚  - æŒ‰ä¾èµ–é¡ºåºåˆ—å‡ºæºæ–‡ä»¶             â”‚
â”‚  - ç”ŸæˆMakeä¾èµ–è§„åˆ™                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸»Makefileè‡ªåŠ¨include              â”‚
â”‚  - mooseprojects.mk                 â”‚
â”‚    â””â”€ include tran_heat.mk          â”‚
â”‚        â””â”€ include tran_heat_auto.mk â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  make -j8 ä½¿ç”¨æ­£ç¡®çš„ç¼–è¯‘é¡ºåº       â”‚
â”‚  âœ… ç¼–è¯‘æˆåŠŸï¼                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ’¡ ç¤ºä¾‹åœºæ™¯

### åœºæ™¯1ï¼šæ·»åŠ æ–°æ¨¡å—

**1. åˆ›å»ºæ–°æ–‡ä»¶**
```bash
cat > contrib/tran_heat/src/new_physics.f90 << 'EOF'
module new_physics
    use reactor_interfaces
    implicit none
    ! ä½ çš„ä»£ç ...
end module new_physics
EOF
```

**2. æ›´æ–°ä¾èµ–**
```bash
make update-fortran-deps
```

**è¾“å‡ºï¼š**
```
âœ… Makefileå·²ç”Ÿæˆ: contrib/tran_heat/tran_heat_auto.mk
âœ… ä¾èµ–é…ç½®å·²æ›´æ–°ï¼
```

**3. ç¼–è¯‘**
```bash
make -j8
```

**å®Œæˆï¼** æ–°æ¨¡å—ä¼šè‡ªåŠ¨ï¼š
- âœ… è¢«æ£€æµ‹åˆ°
- âœ… åŠ å…¥åˆ°ç¼–è¯‘åˆ—è¡¨
- âœ… æ”¾åœ¨æ­£ç¡®çš„ç¼–è¯‘é¡ºåºä½ç½®

---

### åœºæ™¯2ï¼šå¤æ‚ä¾èµ–å…³ç³»

å‡è®¾ä½ æœ‰è¿™äº›æ–‡ä»¶ï¼š

```fortran
! constants.f90
module constants
    real :: PI = 3.14159
end module

! types.f90
module types
    use constants
    ! ...
end module

! physics.f90
module physics
    use constants
    use types
    ! ...
end module

! reactor.f90
module reactor
    use physics
    ! ...
end module
```

**è¿è¡Œï¼š**
```bash
make update-fortran-deps
```

**è‡ªåŠ¨ç”Ÿæˆçš„ç¼–è¯‘é¡ºåºï¼š**
```
1. constants.f90    â† ä¸ä¾èµ–å…¶ä»–æ¨¡å—
2. types.f90        â† ä¾èµ– constants
3. physics.f90      â† ä¾èµ– constants å’Œ types
4. reactor.f90      â† ä¾èµ– physics
```

**å®Œç¾Žï¼** ä¸éœ€è¦æ‰‹åŠ¨è®¡ç®—ä¾èµ–å…³ç³»ã€‚

---

## ðŸ› å¸¸è§é—®é¢˜

### Q1: ç¼–è¯‘æ—¶ä»ç„¶æŠ¥é”™æ‰¾ä¸åˆ° .mod æ–‡ä»¶

**A:** ç¡®ä¿è¿è¡Œäº†æ›´æ–°å‘½ä»¤ï¼š
```bash
make clean-tran_heat
make update-fortran-deps
make -j2  # å‡å°‘å¹¶è¡Œæ•°è¯•è¯•
```

### Q2: `tran_heat_auto.mk` æ˜¯å¦éœ€è¦æäº¤åˆ°Gitï¼Ÿ

**A:** **å»ºè®®æäº¤**ï¼åŽŸå› ï¼š
- âœ… å›¢é˜Ÿæˆå‘˜cloneåŽå¯ä»¥ç›´æŽ¥ç¼–è¯‘
- âœ… CI/CDå¯ä»¥ç›´æŽ¥ä½¿ç”¨
- âœ… å¯è¿½è¸ªä¾èµ–å˜åŒ–åŽ†å²

```bash
git add contrib/tran_heat/tran_heat_auto.mk
git commit -m "Update Fortran module dependencies"
```

### Q3: å¦‚ä½•æŸ¥çœ‹å½“å‰ä¾èµ–å…³ç³»ï¼Ÿ

**A:** ä½¿ç”¨æ£€æŸ¥å‘½ä»¤ï¼š
```bash
make check-fortran-deps
```

### Q4: Pythonè„šæœ¬åœ¨å“ªé‡Œï¼Ÿ

**A:** `contrib/analyze_fortran_deps.py`

å¯ä»¥å•ç‹¬è¿è¡Œï¼š
```bash
python3 contrib/analyze_fortran_deps.py contrib/tran_heat/src
```

---

## âš™ï¸ é«˜çº§ç”¨æ³•

### æ‰‹åŠ¨è¿è¡ŒPythonè„šæœ¬

```bash
# åªæŸ¥çœ‹åˆ†æžç»“æžœ
python3 contrib/analyze_fortran_deps.py contrib/tran_heat/src

# ç”Ÿæˆåˆ°è‡ªå®šä¹‰æ–‡ä»¶
python3 contrib/analyze_fortran_deps.py contrib/tran_heat/src \
    -o my_custom.mk

# é™é»˜æ¨¡å¼
python3 contrib/analyze_fortran_deps.py contrib/tran_heat/src \
    -o contrib/tran_heat/tran_heat_auto.mk -q
```

### æŸ¥çœ‹å¸®åŠ©
```bash
python3 contrib/analyze_fortran_deps.py --help
```

---

## ðŸ“š è¯¦ç»†æ–‡æ¡£

| æ–‡æ¡£ | å†…å®¹ | é€‚åˆ |
|------|------|------|
| **æœ¬æ–‡ä»¶** | å¿«é€Ÿå‚è€ƒ | æ—¥å¸¸ä½¿ç”¨ |
| `AUTO_WORKFLOW.md` | å®Œæ•´å·¥ä½œæµç¨‹ | ç†è§£åŽŸç† |
| `FORTRAN_DEPENDENCY_GUIDE.md` | æŠ€æœ¯ç»†èŠ‚ã€4ç§æ–¹æ¡ˆ | æ·±å…¥å­¦ä¹  |
| `QUICK_START.md` | 5åˆ†é’Ÿä¸Šæ‰‹ | æ–°æ‰‹å…¥é—¨ |

---

## âœ… æ€»ç»“

ä½ çŽ°åœ¨æ‹¥æœ‰çš„æ˜¯ä¸€ä¸ª**ç”Ÿäº§çº§çš„Fortranä¾èµ–ç®¡ç†ç³»ç»Ÿ**ï¼š

- âœ… **å®Œå…¨è‡ªåŠ¨åŒ–** - ä¸€æ¡å‘½ä»¤æžå®š
- âœ… **é›¶é…ç½®** - è‡ªåŠ¨æ£€æµ‹æ‰€æœ‰æ–‡ä»¶
- âœ… **æ™ºèƒ½åˆ†æž** - è‡ªåŠ¨è®¡ç®—ä¾èµ–å…³ç³»
- âœ… **å¯é æ€§é«˜** - åŸºäºŽæ‹“æ‰‘æŽ’åºç®—æ³•
- âœ… **æ˜“äºŽç»´æŠ¤** - æ·»åŠ æ–°æ–‡ä»¶æ— éœ€æ‰‹åŠ¨é…ç½®
- âœ… **é€‚åº”å¤§é¡¹ç›®** - å¯å¤„ç†ä»»æ„å¤æ‚åº¦

**è®°ä½æ ¸å¿ƒå‘½ä»¤ï¼š**
```bash
make update-fortran-deps
```

å…¶ä»–çš„äº¤ç»™è‡ªåŠ¨åŒ–ï¼ðŸŽ‰

---

## ðŸ†˜ èŽ·å–å¸®åŠ©

1. **æŸ¥çœ‹å½“å‰çŠ¶æ€ï¼š** `make debug-tran_heat`
2. **æ£€æŸ¥ä¾èµ–å…³ç³»ï¼š** `make check-fortran-deps`
3. **é˜…è¯»è¯¦ç»†æ–‡æ¡£ï¼š** `cat contrib/AUTO_WORKFLOW.md`
4. **æ¸…ç†é‡å»ºï¼š** `make clean-tran_heat && make -j8`

---

**æœ€åŽæ›´æ–°ï¼š** 2025-10-21  
**çŠ¶æ€ï¼š** âœ… ç”Ÿäº§å°±ç»ª

