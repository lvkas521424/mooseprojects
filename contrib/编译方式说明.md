# Fortranå¤–éƒ¨ç¨‹åºç¼–è¯‘ - ä¸¤ç§æ–¹å¼

## ðŸŽ¯ ç®€å•å›žç­”ä½ çš„é—®é¢˜

**æ˜¯çš„ï¼Œå®Œå…¨å¯ä»¥ç›´æŽ¥è°ƒç”¨CMakeListsç¼–è¯‘ï¼**

ä½ çš„é¡¹ç›®çŽ°åœ¨æ”¯æŒ**ä¸¤ç§æ–¹å¼**ï¼š

---

## æ–¹å¼1ï¼šCMakeç¼–è¯‘ï¼ˆå½“å‰é»˜è®¤ï¼ŒæŽ¨èï¼‰âœ…

### ä½¿ç”¨æ–¹æ³•

```bash
# ç›´æŽ¥ç¼–è¯‘ï¼ŒCMakeä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–
make -j8
```

### ä¼˜ç‚¹
- âœ… **é›¶é…ç½®** - ä½ çš„CMakeLists.txtä¼šè‡ªåŠ¨è¢«è°ƒç”¨
- âœ… **è‡ªåŠ¨ä¾èµ–** - CMakeè‡ªåŠ¨å¤„ç†.modæ–‡ä»¶ä¾èµ–
- âœ… **æ·»åŠ æ–°æ–‡ä»¶** - åªéœ€ `make -j8`ï¼ŒCMakeè‡ªåŠ¨æ£€æµ‹

### å·¥ä½œåŽŸç†
```
make -j8
  â†“
è‡ªåŠ¨è°ƒç”¨: cd contrib/tran_heat && cmake ...
  â†“
CMakeåˆ†æžä¾èµ– â†’ ç¼–è¯‘Fortran â†’ ç”Ÿæˆlibtran_heat.a
  â†“
é“¾æŽ¥åˆ°mooseprojectsä¸»ç¨‹åº
  â†“
å®Œæˆï¼
```

### æ¸…ç†
```bash
make clean-tran_heat
```

---

## æ–¹å¼2ï¼šç›´æŽ¥ç¼–è¯‘ï¼ˆè‡ªåŠ¨ä¾èµ–åˆ†æžï¼‰

### åˆ‡æ¢æ–¹æ³•

ç¼–è¾‘ `mooseprojects.mk` ç¬¬12è¡Œï¼š
```makefile
# ä»Ž
USE_CMAKE_FOR_FORTRAN ?= yes

# æ”¹ä¸º
USE_CMAKE_FOR_FORTRAN ?= no
```

### ä½¿ç”¨æ–¹æ³•

```bash
# é¦–æ¬¡æˆ–æ·»åŠ æ–°æ–‡ä»¶åŽ
make update-fortran-deps

# ç¼–è¯‘
make -j8
```

### ä¼˜ç‚¹
- âœ… **é€æ˜Ž** - å¯ä»¥çœ‹åˆ°å®Œæ•´çš„ç¼–è¯‘è¿‡ç¨‹
- âœ… **çµæ´»** - å¯ä»¥æ‰‹åŠ¨è°ƒæ•´ç¼–è¯‘å‚æ•°
- âœ… **å­¦ä¹ ** - ç†è§£Makeå’ŒFortranä¾èµ–

---

## ðŸš€ æŽ¨èç”¨æ³•

### å¦‚æžœä½ çš„CMakeLists.txtå·²ç»é…ç½®å¥½äº†

**ðŸ‘‰ ä½¿ç”¨æ–¹å¼1ï¼ˆCMakeï¼‰- å½“å‰é»˜è®¤**

```bash
# ä»€ä¹ˆéƒ½ä¸ç”¨æ”¹ï¼Œç›´æŽ¥ç”¨
make -j8
```

### å¦‚æžœä½ æƒ³è¦æ›´å¤šæŽ§åˆ¶æƒ

**ðŸ‘‰ åˆ‡æ¢åˆ°æ–¹å¼2ï¼ˆè‡ªåŠ¨ä¾èµ–åˆ†æžï¼‰**

```bash
# 1. ä¿®æ”¹ mooseprojects.mk: USE_CMAKE_FOR_FORTRAN ?= no
# 2. make update-fortran-deps
# 3. make -j8
```

---

## ðŸ“‹ å®Œæ•´ç¤ºä¾‹

### ä½¿ç”¨CMakeï¼ˆæŽ¨èï¼Œé›¶é…ç½®ï¼‰

```bash
cd /home/lvkas/projects/mooseprojects

# æ·»åŠ æ–°çš„Fortranæ–‡ä»¶
cat > contrib/tran_heat/src/new_physics.f90 << 'EOF'
module new_physics
    implicit none
    ! ä½ çš„ä»£ç ...
end module new_physics
EOF

# CMakeä¼šè‡ªåŠ¨æ£€æµ‹ï¼Œç›´æŽ¥ç¼–è¯‘
make -j8

# å®Œæˆï¼âœ…
```

### ä½¿ç”¨è‡ªåŠ¨ä¾èµ–åˆ†æž

```bash
cd /home/lvkas/projects/mooseprojects

# 1. åˆ‡æ¢æ¨¡å¼ï¼ˆç¼–è¾‘mooseprojects.mkï¼‰
# USE_CMAKE_FOR_FORTRAN ?= no

# 2. æ·»åŠ æ–°çš„Fortranæ–‡ä»¶
cat > contrib/tran_heat/src/new_physics.f90 << 'EOF'
module new_physics
    implicit none
    ! ä½ çš„ä»£ç ...
end module new_physics
EOF

# 3. æ›´æ–°ä¾èµ–
make update-fortran-deps

# 4. ç¼–è¯‘
make -j8

# å®Œæˆï¼âœ…
```

---

## ðŸ”„ åˆ‡æ¢æ–¹å¼

### æ°¸ä¹…åˆ‡æ¢

ç¼–è¾‘ `mooseprojects.mk`ï¼š
```makefile
USE_CMAKE_FOR_FORTRAN ?= yes   # ä½¿ç”¨CMake
# æˆ–
USE_CMAKE_FOR_FORTRAN ?= no    # ä½¿ç”¨è‡ªåŠ¨ä¾èµ–åˆ†æž
```

### ä¸´æ—¶åˆ‡æ¢ï¼ˆä¸€æ¬¡æ€§ï¼‰

```bash
# ä¸´æ—¶ä½¿ç”¨CMake
make USE_CMAKE_FOR_FORTRAN=yes -j8

# ä¸´æ—¶ä½¿ç”¨è‡ªåŠ¨ä¾èµ–
make USE_CMAKE_FOR_FORTRAN=no update-fortran-deps
make USE_CMAKE_FOR_FORTRAN=no -j8
```

---

## ðŸŽ“ å¯¹æ¯”æ€»ç»“

|  | CMake | è‡ªåŠ¨ä¾èµ–åˆ†æž |
|---|------|------------|
| **å‘½ä»¤** | `make -j8` | `make update-fortran-deps && make -j8` |
| **æ–°å¢žæ–‡ä»¶** | è‡ªåŠ¨æ£€æµ‹ | éœ€è¿è¡Œupdateå‘½ä»¤ |
| **ä¾èµ–å¤„ç†** | CMakeè‡ªåŠ¨ | Pythonè„šæœ¬è‡ªåŠ¨ |
| **é…ç½®æ–‡ä»¶** | CMakeLists.txt | tran_heat_auto.mk |
| **é€‚åˆåœºæ™¯** | å¤§åž‹å·²æœ‰é¡¹ç›® | æ–°é¡¹ç›®æˆ–éœ€è¦ç²¾ç»†æŽ§åˆ¶ |
| **å½“å‰é»˜è®¤** | âœ… | - |

---

## âœ… ç»“è®º

**ä½ å¯ä»¥ç»§ç»­ä½¿ç”¨ä½ ç†Ÿæ‚‰çš„CMakeLists.txtï¼**

å½“å‰é…ç½®å·²ç»æ˜¯CMakeæ¨¡å¼ï¼Œä»€ä¹ˆéƒ½ä¸ç”¨æ”¹ï¼Œç›´æŽ¥ï¼š

```bash
make -j8
```

æ‰€æœ‰çš„æ¨¡å—ä¾èµ–éƒ½ç”±CMakeè‡ªåŠ¨å¤„ç†ï¼Œæ— éœ€æ‹…å¿ƒ`.mod`æ–‡ä»¶é—®é¢˜ï¼

---

## ðŸ“š è¯¦ç»†æ–‡æ¡£

- `CMAKE_vs_DIRECT.md` - ä¸¤ç§æ–¹å¼çš„è¯¦ç»†å¯¹æ¯”
- `README_FORTRAN.md` - å®Œæ•´å‚è€ƒæ‰‹å†Œ
- `AUTO_WORKFLOW.md` - è‡ªåŠ¨ä¾èµ–åˆ†æžå·¥ä½œæµç¨‹
- `ä½¿ç”¨è¯´æ˜Ž.txt` - å¿«é€Ÿå‚è€ƒå¡ç‰‡

---

**æœ‰ä»»ä½•é—®é¢˜ï¼Œç›´æŽ¥è¿è¡Œï¼š**
```bash
make debug-tran_heat    # æŸ¥çœ‹å½“å‰é…ç½®
make clean-tran_heat    # æ¸…ç†é‡å»º
```

